#include "../../../../contrib/catch/catch.hpp"

#include "../../src/commands_parser/parser.h"
#include "../../src/image/image.h"
#include "../../src/filters/scale_filter.h"
#include "../../src/filters/negative_filter.h"
#include "../../src/filters/grayscale_filter.h"
#include "../../src/filters/sharpening_filter.h"
#include "../../src/filters/edge_detection_filter.h"
#include "../../src/filters/crop_filter.h"
#include "../../src/filters/gaussian_blur_filter.h"
#include "../../src/filters/crystallize_filter.h"

#include <vector>

TEST_CASE("Parser test") {
    const char* argv[] = {
        "./image_processor", "input.bmp", "/tmp/output.bmp", "-crop", "800", "600", "-gs", "-blur", "0.5"};
    int argc = sizeof(argv) / sizeof(argv[0]);

    const CmdParams cmd_params_target = {
        "input.bmp",
        "/tmp/output.bmp",
        {{FilterType::Crop, 800, 600, 0}, {FilterType::Grayscale, 0, 0, 0}, {FilterType::GaussianBlur, 0, 0, 0.5}}};

    Parser parser;

    REQUIRE(parser.Parse(argc, const_cast<char**>(argv)) == cmd_params_target);  // NOLINT
}

TEST_CASE("Image read test") {
    const Header header{19778, 694, 0, 0, 54};
    const InfoHeader info_header{40, 10, 20, 1, 24, 0, 0, 0, 0, 0, 0};
    const Pixels pixels{{{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 187, 0},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 187, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 0},
                         {0, 0, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0}},
                        {{187, 0, 0},
                         {187, 0, 0},
                         {0, 0, 255},
                         {0, 0, 255},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0},
                         {0, 0, 0}}};

    Image image_target{header, info_header, pixels};

    const char* argv[] = {"./image_processor", "../../../test_script/data/flag.bmp", "test.bmp", "-neg"};
    int argc = sizeof(argv) / sizeof(argv[0]);

    Parser parser;
    CmdParams cmd_params = parser.Parse(argc, const_cast<char**>(argv));  // NOLINT

    Image image_from_cmd(cmd_params.InputFilePath);

    REQUIRE(image_from_cmd == image_target);
}

TEST_CASE("Gaussian blur filter test") {
    const Header header{19778, 694, 0, 0, 54};
    const InfoHeader info_header{40, 10, 20, 1, 24, 0, 0, 0, 0, 0, 0};
    const Pixels pixels{
        {{112, 58, 21}, {98, 69, 22},  {87, 81, 22},  {73, 93, 23}, {63, 105, 23}, {52, 116, 21}, {41, 127, 20},
         {33, 137, 19}, {25, 146, 16}, {19, 155, 14}, {0, 0, 0},    {0, 0, 0},     {0, 0, 0},     {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},     {0, 0, 0}},
        {{112, 57, 23}, {98, 67, 24},  {87, 79, 24},  {73, 91, 25}, {63, 103, 25}, {52, 114, 24}, {41, 125, 22},
         {33, 135, 21}, {25, 144, 19}, {19, 152, 16}, {0, 0, 0},    {0, 0, 0},     {0, 0, 0},     {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},     {0, 0, 0}},
        {{112, 55, 25}, {98, 65, 26},  {87, 77, 27},  {73, 88, 28}, {63, 100, 28}, {52, 111, 27}, {41, 122, 25},
         {33, 132, 24}, {25, 141, 21}, {19, 149, 19}, {0, 0, 0},    {0, 0, 0},     {0, 0, 0},     {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},     {0, 0, 0}},
        {{112, 53, 27}, {98, 63, 29},  {87, 74, 30},  {73, 85, 31}, {63, 97, 32}, {52, 108, 30}, {41, 118, 29},
         {33, 128, 27}, {25, 137, 25}, {19, 145, 22}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},     {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 50, 30}, {98, 60, 32},  {87, 71, 34},  {73, 81, 35}, {63, 93, 36}, {52, 103, 34}, {41, 114, 33},
         {33, 124, 31}, {25, 132, 28}, {19, 141, 25}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},     {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 47, 33}, {98, 56, 36},  {87, 67, 38},  {73, 77, 39}, {63, 88, 40}, {52, 98, 39}, {41, 109, 38},
         {33, 118, 36}, {25, 127, 33}, {19, 135, 29}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 44, 37}, {98, 53, 39},  {87, 63, 42},  {73, 72, 44}, {63, 83, 45}, {52, 93, 44}, {41, 103, 42},
         {33, 112, 40}, {25, 120, 37}, {19, 128, 34}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 40, 40}, {98, 48, 43},  {87, 58, 46},  {73, 67, 48}, {63, 77, 49}, {52, 87, 48}, {41, 96, 47},
         {33, 105, 45}, {25, 113, 42}, {19, 121, 38}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 37, 43}, {98, 44, 47},  {87, 53, 50},  {73, 61, 53}, {63, 71, 54}, {52, 80, 53}, {41, 88, 52},
         {33, 97, 50},  {25, 105, 46}, {19, 112, 43}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},     {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 33, 46}, {98, 40, 50}, {87, 47, 54},  {73, 56, 57}, {63, 64, 58}, {52, 72, 58}, {41, 81, 57},
         {33, 88, 54},  {25, 96, 51}, {19, 103, 47}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},    {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 29, 49}, {98, 35, 54}, {87, 42, 57}, {73, 49, 60}, {63, 57, 62}, {52, 65, 62}, {41, 72, 61},
         {33, 80, 58},  {25, 87, 54}, {19, 93, 50}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 25, 51}, {98, 30, 56}, {87, 37, 60}, {73, 43, 63}, {63, 50, 65}, {52, 57, 65}, {41, 64, 64},
         {33, 71, 61},  {25, 77, 57}, {19, 83, 53}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 21, 53}, {98, 26, 58}, {87, 31, 62}, {73, 37, 65}, {63, 43, 67}, {52, 49, 67}, {41, 56, 66},
         {33, 62, 63},  {25, 67, 59}, {19, 73, 55}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 18, 53}, {98, 22, 59}, {87, 26, 63}, {73, 31, 66}, {63, 37, 68}, {52, 42, 68}, {41, 47, 67},
         {33, 53, 64},  {25, 58, 60}, {19, 63, 56}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 14, 54}, {98, 18, 59}, {87, 22, 63}, {73, 26, 67}, {63, 31, 68}, {52, 35, 68}, {41, 40, 67},
         {33, 44, 64},  {25, 49, 60}, {19, 53, 56}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 12, 53}, {98, 14, 58}, {87, 18, 63}, {73, 21, 66}, {63, 25, 67}, {52, 29, 67}, {41, 33, 66},
         {33, 37, 63},  {25, 40, 59}, {19, 44, 54}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},     {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 9, 52}, {98, 11, 57}, {87, 14, 61}, {73, 17, 64}, {63, 20, 65}, {52, 23, 65}, {41, 26, 64},
         {33, 30, 61}, {25, 33, 57}, {19, 36, 52}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 7, 51}, {98, 9, 55},  {87, 11, 59}, {73, 13, 62}, {63, 16, 63}, {52, 18, 63}, {41, 21, 61},
         {33, 23, 58}, {25, 26, 54}, {19, 28, 50}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 5, 49}, {98, 7, 53},  {87, 8, 57},  {73, 10, 59}, {63, 12, 60}, {52, 14, 60}, {41, 16, 58},
         {33, 18, 55}, {25, 20, 51}, {19, 22, 46}, {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0}},
        {{112, 4, 47}, {98, 5, 50},  {87, 6, 54},  {73, 7, 56}, {63, 9, 56}, {52, 10, 56}, {41, 12, 54},
         {33, 14, 51}, {25, 15, 47}, {19, 17, 43}, {0, 0, 0},   {0, 0, 0},   {0, 0, 0},    {0, 0, 0},
         {0, 0, 0},    {0, 0, 0},    {0, 0, 0},    {0, 0, 0},   {0, 0, 0},   {0, 0, 0}},
    };

    Image image_blur_target{header, info_header, pixels};

    const char* argv[] = {"./image_processor", "../../../test_script/data/flag.bmp", "test.bmp", "-blur", "6.0"};
    int argc = sizeof(argv) / sizeof(argv[0]);

    Parser parser;
    CmdParams cmd_params = parser.Parse(argc, const_cast<char**>(argv));  // NOLINT

    Image image_from_cmd(cmd_params.InputFilePath);

    GaussianBlur filter;
    filter.Process(image_from_cmd, cmd_params.FiltersParams[0].IntParam1, cmd_params.FiltersParams[0].IntParam2,
                   cmd_params.FiltersParams[0].DoubleParam);

    REQUIRE(image_from_cmd == image_blur_target);
}
